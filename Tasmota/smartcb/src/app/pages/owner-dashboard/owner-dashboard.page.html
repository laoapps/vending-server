<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Owner Dashboard</ion-card-title>
    </ion-card-header>
    <ion-card-content>
       <ion-item-group>
        <ion-item-divider>Add Schedule Package</ion-item-divider>
        <ion-item>
          <ion-label position="floating">Name</ion-label>
          <ion-input [(ngModel)]="newSchedulePackage.name"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Price (LAK)</ion-label>
          <ion-input type="number" [(ngModel)]="newSchedulePackage.price"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Condition Type</ion-label>
          <ion-select [(ngModel)]="newSchedulePackage.conditionType">
            <ion-select-option value="time_duration">Time Duration</ion-select-option>
            <ion-select-option value="energy_consumption">Energy Consumption</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Condition Value ({{ newSchedulePackage.conditionType === 'time_duration' ? 'Hours' : 'kWh' }})</ion-label>
          <ion-input type="number" [(ngModel)]="newSchedulePackage.conditionValue"></ion-input>
        </ion-item>
        <ion-button expand="block" (click)="addSchedulePackage()">Add Schedule Package</ion-button>
      </ion-item-group>

      <!-- List Schedule Packages -->
      <ion-item-group>
        <ion-item-divider>Schedule Packages</ion-item-divider>
        <ion-item *ngFor="let pkg of schedulePackages">
          <ion-label>
            <h2>{{ pkg.name }}</h2>
            <p>Price: {{ pkg.price }} LAK</p>
            <p>Condition: {{ pkg.conditionType === 'time_duration' ? pkg.conditionValue + ' hours' : pkg.conditionValue + ' kWh' }}</p>
          </ion-label>
          <ion-button slot="end" color="danger" (click)="deleteSchedulePackage(pkg.id)">Delete</ion-button>
        </ion-item>
      </ion-item-group>
      <!-- Devices -->
      <ion-item-group>
        <ion-item-divider>Devices</ion-item-divider>
        <ion-item *ngFor="let device of devices">
          <ion-label>
            <h2>{{ device.name }}</h2>
            <p>Tasmota ID: {{ device.tasmotaId }}</p>
            <p>Zone: {{ device.zone || 'N/A' }}</p>
            <p>Group: {{ device.group?.name || 'N/A' }}</p>
            <p>Power: {{ device.power }} W</p>
            <p>Energy: {{ device.energy }} kWh</p>
            <p>Status: {{ device.status | json }}</p>
          </ion-label>
          <ion-button slot="end" (click)="togglePower(device.id)">Toggle</ion-button>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Name</ion-label>
          <ion-input [(ngModel)]="newDevice.name"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Tasmota ID</ion-label>
          <ion-input [(ngModel)]="newDevice.tasmotaId"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Zone</ion-label>
          <ion-input [(ngModel)]="newDevice.zone"></ion-input>
        </ion-item>
        <ion-button expand="block" (click)="addDevice()">Add Device</ion-button>
      </ion-item-group>

      <!-- Groups -->
      <ion-item-group>
        <ion-item-divider>Groups</ion-item-divider>
        <ion-item *ngFor="let group of groups">
          <ion-label>
            <h2>{{ group.name }}</h2>
            <p>Devices: {{ group.devices.length }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Group Name</ion-label>
          <ion-input [(ngModel)]="newGroup.name"></ion-input>
        </ion-item>
        <ion-button expand="block" (click)="addGroup()">Add Group</ion-button>
        <ion-item>
          <ion-label>Group</ion-label>
          <ion-select [(ngModel)]="assignDevice.groupId">
            <ion-select-option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Device</ion-label>
          <ion-select [(ngModel)]="assignDevice.deviceId">
            <ion-select-option *ngFor="let device of devices" [value]="device.id">{{ device.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-button expand="block" (click)="assignDeviceToGroup()">Assign Device to Group</ion-button>
      </ion-item-group>

      <!-- Schedules -->
      <ion-item-group>
        <ion-item-divider>Schedules</ion-item-divider>
        <ion-item *ngFor="let schedule of schedules">
          <ion-label>
            <h2>{{ schedule.device.name }}</h2>
            <p>Type: {{ schedule.type }}</p>
            <p>Cron: {{ schedule.cron || 'N/A' }}</p>
            <p>Command: {{ schedule.command }}</p>
            <p>Condition: {{ schedule.conditionType || 'N/A' }} {{ schedule.conditionValue || '' }}</p>
            <p>Active: {{ schedule.active }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>Device</ion-label>
          <ion-select [(ngModel)]="newSchedule.deviceId">
            <ion-select-option *ngFor="let device of devices" [value]="device.id">{{ device.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Type</ion-label>
          <ion-select [(ngModel)]="newSchedule.type">
            <ion-select-option value="timer">Timer</ion-select-option>
            <ion-select-option value="conditional">Conditional</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item *ngIf="newSchedule.type === 'timer'">
          <ion-label position="floating">Cron (e.g., 0 7 * * *)</ion-label>
          <ion-input [(ngModel)]="newSchedule.cron"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Command (e.g., POWER ON)</ion-label>
          <ion-input [(ngModel)]="newSchedule.command"></ion-input>
        </ion-item>
        <ion-item *ngIf="newSchedule.type === 'conditional'">
          <ion-label>Condition</ion-label>
          <ion-select [(ngModel)]="newSchedule.conditionType">
            <ion-select-option value="power_overload">Power Overload</ion-select-option>
            <ion-select-option value="energy_limit">Energy Limit</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item *ngIf="newSchedule.type === 'conditional'">
          <ion-label position="floating">Value (W or kWh)</ion-label>
          <ion-input type="number" [(ngModel)]="newSchedule.conditionValue"></ion-input>
        </ion-item>
        <ion-button expand="block" (click)="addSchedule()">Add Schedule</ion-button>
      </ion-item-group>

      <!-- User Assignment -->
      <ion-item-group>
        <ion-item-divider>Assign Device to User</ion-item-divider>
        <ion-item>
          <ion-label>Device</ion-label>
          <ion-select [(ngModel)]="assignUser.deviceId">
            <ion-select-option *ngFor="let device of devices" [value]="device.id">{{ device.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="floating">User Phone Number</ion-label>
          <ion-input [(ngModel)]="assignUser.userPhoneNumber"></ion-input>
        </ion-item>
        <ion-button expand="block" (click)="assignDeviceToUser()">Assign Device</ion-button>
      </ion-item-group>
    </ion-card-content>
  </ion-card>
</ion-content>