<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Owner Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Tabs -->
  <ion-segment [(ngModel)]="selectedTab" class="ion-margin-bottom">
    <ion-segment-button value="packages">
      <ion-label>Packages</ion-label>
    </ion-segment-button>
    <ion-segment-button value="devices">
      <ion-label>Devices</ion-label>
    </ion-segment-button>
    <ion-segment-button value="groups">
      <ion-label>Groups</ion-label>
    </ion-segment-button>
  </ion-segment>

  <ng-container [ngSwitch]="selectedTab">

    <!-- üì¶ Schedule Packages -->
    <div *ngSwitchCase="'packages'">
      <ion-list>
        <ion-list-header>
          <ion-label><strong>‚ûï Add Schedule Package</strong></ion-label>
        </ion-list-header>

        <ion-item>
          <ion-label position="floating">Name</ion-label>
          <ion-input [(ngModel)]="newSchedulePackage.name"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Price (LAK)</ion-label>
          <ion-input type="number" [(ngModel)]="newSchedulePackage.price"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Condition Type</ion-label>
          <ion-select [(ngModel)]="newSchedulePackage.conditionType">
            <ion-select-option value="time_duration">Time Duration</ion-select-option>
            <ion-select-option value="energy_consumption">Energy Consumption</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="floating">
            Condition Value ({{ newSchedulePackage.conditionType === 'time_duration' ? 'Hours' : 'kWh' }})
          </ion-label>
          <ion-input type="number" [(ngModel)]="newSchedulePackage.conditionValue"></ion-input>
        </ion-item>

        <ion-button expand="block" color="success" class="ion-margin-top" (click)="addSchedulePackage()">
          ‚ûï Add Package
        </ion-button>

        <ion-list-header class="ion-margin-top">
          <ion-label><strong>üì¶ Available Packages</strong></ion-label>
        </ion-list-header>

        <ion-item *ngFor="let pkg of schedulePackages">
          <ion-label>
            <h2>{{ pkg.name }}</h2>
            <p>{{ pkg.price }} LAK ‚Ä¢ {{ pkg.conditionValue }} {{ pkg.conditionType === 'time_duration' ? 'hours' : 'kWh' }}</p>
          </ion-label>
          <ion-button fill="clear" color="danger" slot="end" (click)="deleteSchedulePackage(pkg.id)">
            üóëÔ∏è
          </ion-button>
        </ion-item>
      </ion-list>
    </div>

    <!-- üîå Devices -->
    <div *ngSwitchCase="'devices'">
      <ion-list>
        <ion-list-header>
          <ion-label><strong>üîå Device List</strong></ion-label>
        </ion-list-header>

        <ion-item *ngFor="let device of devices">
          <ion-label>
            <h2>{{ device.name }}</h2>
            <p>ID: {{ device.tasmotaId }} ‚Ä¢ Power: {{ device.power }}W ‚Ä¢ Energy: {{ device.energy }}kWh</p>
          </ion-label>
          <ion-button fill="clear" slot="end" (click)="setControlDevice(device.id)">
            ‚öôÔ∏è Control
          </ion-button>
          <ion-button fill="clear" slot="end" (click)="deleteDevice(device.id)">
            üóëÔ∏è RM
          </ion-button>
        </ion-item>

        <!-- ‚öôÔ∏è Control Selected Device -->
        <ng-container *ngIf="controlDevice.id">
          <ion-item-divider class="ion-margin-top">Control Selected Device</ion-item-divider>
          <ion-item>
            <ion-label>Command</ion-label>
            <ion-select [(ngModel)]="controlDevice.command">
              <ion-select-option value="TOGGLE">Toggle</ion-select-option>
              <ion-select-option value="ON">On</ion-select-option>
              <ion-select-option value="OFF">Off</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-label>Relay</ion-label>
            <ion-select [(ngModel)]="controlDevice.relay">
              <ion-select-option value="1">Relay 1</ion-select-option>
              <ion-select-option value="2">Relay 2</ion-select-option>
              <ion-select-option value="3">Relay 3</ion-select-option>
              <ion-select-option value="4">Relay 4</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-button expand="block" color="primary" class="ion-margin-top" (click)="controlDeviceAction()">
            üöÄ Send Command
          </ion-button>
        </ng-container>

        <ion-item-divider class="ion-margin-top">‚ûï Add New Device</ion-item-divider>
        <ion-item>
          <ion-label position="floating">Name</ion-label>
          <ion-input [(ngModel)]="newDevice.name"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Tasmota ID</ion-label>
          <ion-input [(ngModel)]="newDevice.tasmotaId"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Zone</ion-label>
          <ion-input [(ngModel)]="newDevice.zone"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label>Group</ion-label>
          <ion-select [(ngModel)]="newDevice.groupId">
            <ion-select-option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-button expand="block" color="success" class="ion-margin-top" (click)="addDevice()">
          ‚ûï Add Device
        </ion-button>
      </ion-list>
    </div>

    <!-- üë• Groups -->
    <div *ngSwitchCase="'groups'">
      <ion-list>
        <ion-list-header>
          <ion-label><strong>üë• Group List</strong></ion-label>
        </ion-list-header>

        <ion-item *ngFor="let group of groups">
          <ion-label>
            <h2>{{ group.name }}</h2>
            <p>Devices: {{ group.devices.length }}</p>
          </ion-label>
        </ion-item>

        <ion-item-divider class="ion-margin-top">Add Group</ion-item-divider>
        <ion-item>
          <ion-label position="floating">Group Name</ion-label>
          <ion-input [(ngModel)]="newGroup.name"></ion-input>
        </ion-item>
        <ion-button expand="block" color="success" class="ion-margin-top" (click)="addGroup()">
          ‚ûï Add Group
        </ion-button>

        <ion-item-divider class="ion-margin-top">üìå Assign Device to Group</ion-item-divider>
        <ion-item>
          <ion-label>Group</ion-label>
          <ion-select [(ngModel)]="assignDevice.groupId">
            <ion-select-option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Device</ion-label>
          <ion-select [(ngModel)]="assignDevice.deviceId">
            <ion-select-option *ngFor="let device of devices" [value]="device.id">{{ device.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-button expand="block" color="primary" class="ion-margin-top" (click)="assignDeviceToGroup()">
          üîó Assign
        </ion-button>
      </ion-list>
    </div>

  </ng-container>
</ion-content>
